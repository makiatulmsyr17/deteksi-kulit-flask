<!DOCTYPE html>
 <html lang="id">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Halaman Prediksi - SkinTone AI</title>
     <script src="https://cdn.tailwindcss.com"></script>
     <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
     <style>
         body { font-family: 'Inter', sans-serif; background-color: f8fafc; color: 1e293b; }
         .tab-button.active { border-color: 4f46e5; color: 4f46e5; background-color: eef2ff; }
         .tab-panel { display: none; }
         .tab-panel.active { display: block; animation: fadeIn 0.5s ease-in-out; }
         .upload-area { border: 2px dashed d1d5db; }
         .upload-area.dragover { border-color: 4f46e5; background-color: eef2ff; }
         .fade-in { animation: fadeIn 0.5s ease-in-out; }
         @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
         .loader { border-top-color: 4f46e5; animation: spin 1s linear infinite; }
         @keyframes spin { to { transform: rotate(360deg); } }
         video { width: 100%; height: auto; border-radius: 0.5rem; }
     </style>
 </head>
 <body class="antialiased">
 
     <!-- Header -->
     <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-20 border-b border-gray-200">
         <div class="container mx-auto px-6 py-4 flex justify-between items-center">
             <a href="/" class="text-2xl font-bold text-indigo-600">SkinTone AI</a>
             <a href="/" class="text-sm font-medium text-slate-600 hover:text-indigo-600 transition-colors">&larr; Kembali</a>
         </div>
     </header>
 
     <!-- Main Content -->
     <main class="py-12">
         <div class="container mx-auto px-6">
             <div class="bg-white p-8 rounded-2xl shadow-xl max-w-4xl mx-auto">
                 <div class="grid md:grid-cols-2 gap-8 md:gap-12 items-start">
                     
                     <!-- Kolom Kiri: Input (Tabs) -->
                     <div>
                         <h1 class="text-2xl font-bold text-slate-800">Mulai Prediksi</h1>
                         <p class="text-slate-500 mb-6">Pilih metode input: unggah file atau gunakan kamera.</p>
                         
                         <!-- Tab Buttons -->
                         <div class="mb-4 border-b border-gray-200">
                             <nav class="flex space-x-4" aria-label="Tabs">
                                 <button class="tab-button active" data-tab="upload">Unggah File</button>
                                 <button class="tab-button" data-tab="camera">Gunakan Kamera</button>
                             </nav>
                             <style>.tab-button { padding: 8px 16px; font-weight: 600; border-bottom: 2px solid transparent; color: 475569; transition: all 0.2s; }</style>
                         </div>
 
                         <form id="upload-form" method="POST" action="/predict" enctype="multipart/form-data">
                             <!-- Tab Content: Upload File -->
                             <div id="tab-upload" class="tab-panel active">
                                 <label for="image_file" id="upload-label" class="upload-area w-full p-6 rounded-lg text-center cursor-pointer transition-all duration-300 block">
                                     <div class="flex flex-col items-center justify-center min-h-[160px]">
                                         <svg class="mx-auto h-10 w-10 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" /></svg>
                                         <p class="mt-2 text-sm text-gray-600"><span class="font-semibold text-indigo-600">Klik untuk mengunggah</span></p>
                                         <p class="text-xs text-gray-500">PNG, JPG, JPEG</p>
                                     </div>
                                 </label>
                                 <input type="file" name="image_file" id="image_file" accept="image/png, image/jpeg, image/jpg" class="sr-only">
                             </div>
 
                             <!-- Tab Content: Camera -->
                             <div id="tab-camera" class="tab-panel">
                                 <div class="bg-slate-100 rounded-lg p-2">
                                     <video id="camera-feed" autoplay playsinline class="hidden"></video>
                                     <div id="camera-placeholder" class="min-h-[240px] flex items-center justify-center text-slate-500">Kamera tidak aktif</div>
                                 </div>
                                 <div id="camera-controls" class="mt-2 flex space-x-2">
                                     <button type="button" id="start-camera-btn" class="w-full text-sm bg-slate-200 text-slate-700 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 transition-colors">Mulai Kamera</button>
                                     <button type="button" id="capture-btn" class="w-full text-sm bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors hidden">Ambil Gambar</button>
                                 </div>
                                 <canvas id="capture-canvas" class="hidden"></canvas>
                                 <input type="hidden" name="camera_data" id="camera-data">
                             </div>
 
                             <!-- Tombol Prediksi Utama -->
                             <button type="submit" id="submit-button" class="mt-6 w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-300 shadow-lg shadow-indigo-200 flex items-center justify-center disabled:bg-slate-400 disabled:cursor-not-allowed" disabled>
                                 <span id="button-text">Prediksi Sekarang</span>
                                 <div id="loader" class="loader h-5 w-5 rounded-full border-2 border-white border-t-indigo-600 hidden ml-2"></div>
                             </button>
                         </form>
                     </div>
 
                     <!-- Kolom Kanan: Hasil -->
                     <div id="result-area" class="mt-6 md:mt-0">
                         <h2 class="text-xl font-bold text-slate-800 mb-4">Hasil Analisis</h2>
                         <div id="result-content" class="p-4 bg-slate-50 border border-slate-200 rounded-lg text-center min-h-[200px] flex items-center justify-center">
                             {% if error %}
                             <div class="fade-in p-4 bg-red-100 border border-red-300 rounded-lg text-center w-full">
                                 <h3 class="font-bold text-red-800">Terjadi Kesalahan</h3>
                                 <p class="text-sm text-red-700 mt-1">{{ error }}</p>
                             </div>
                             {% elif prediction %}
                             <div class="fade-in text-center p-6 bg-green-50 border border-green-200 rounded-lg w-full">
                                 <p class="text-sm font-medium text-slate-500">Gambar yang dianalisis:</p>
                                 <img src="{{ uploaded_image }}" alt="Gambar yang dianalisis" class="h-40 w-40 object-cover rounded-lg mx-auto my-4 shadow-md">
                                 <p class="font-semibold text-green-800 text-lg">Hasil Prediksi:</p>
                                 <p class="text-5xl font-extrabold text-green-600 capitalize mt-1">
                                     {{ prediction.replace('-', ' ') }}
                                 </p>
                             </div>
                             {% else %}
                             <div id="result-placeholder">
                                 <h3 class="font-semibold text-slate-700">Menunggu Hasil</h3>
                                 <p class="text-sm text-slate-500 mt-1">Hasil prediksi akan muncul di sini.</p>
                             </div>
                             {% endif %}
                         </div>
                     </div>
                 </div>
             </div>
         </div>
     </main>
 
     <script>
         document.addEventListener('DOMContentLoaded', () => {
             // Elemen-elemen UI
             const form = document.getElementById('upload-form');
             const imageInput = document.getElementById('image_file');
             const cameraDataInput = document.getElementById('camera-data');
             const submitButton = document.getElementById('submit-button');
             const buttonText = document.getElementById('button-text');
             const loader = document.getElementById('loader');
             const resultContainer = document.getElementById('result-content');
             
             // Elemen-elemen Tab
             const tabButtons = document.querySelectorAll('.tab-button');
             const tabPanels = document.querySelectorAll('.tab-panel');
 
             // Elemen-elemen Kamera
             const startCameraButton = document.getElementById('start-camera-btn');
             const captureButton = document.getElementById('capture-btn');
             const videoFeed = document.getElementById('camera-feed');
             const canvas = document.getElementById('capture-canvas');
             const cameraPlaceholder = document.getElementById('camera-placeholder');
             let stream = null;
 
             // Fungsi untuk mengaktifkan tombol submit
             const enableSubmit = () => {
                 submitButton.disabled = false;
             };
 
             // Logika Tab
             tabButtons.forEach(button => {
                 button.addEventListener('click', () => {
                     tabButtons.forEach(btn => btn.classList.remove('active'));
                     button.classList.add('active');
                     tabPanels.forEach(panel => {
                         panel.classList.toggle('active', panel.id === `tab-${button.dataset.tab}`);
                     });
                     // Hentikan kamera jika pindah dari tab kamera
                     if (button.dataset.tab !== 'camera' && stream) {
                         stream.getTracks().forEach(track => track.stop());
                         videoFeed.classList.add('hidden');
                         cameraPlaceholder.classList.remove('hidden');
                         startCameraButton.classList.remove('hidden');
                         captureButton.classList.add('hidden');
                         stream = null;
                     }
                 });
             });
 
             // Logika Upload File
             imageInput.addEventListener('change', function() {
                 if (this.files[0]) {
                     const reader = new FileReader();
                     reader.onload = (e) => {
                         resultContainer.innerHTML = `<img src="${e.target.result}" alt="Pratinjau" class="h-40 w-40 object-cover rounded-lg mx-auto shadow-md">`;
                     };
                     reader.readAsDataURL(this.files[0]);
                     enableSubmit();
                 }
             });
 
             // Logika Kamera
             startCameraButton.addEventListener('click', async () => {
                 if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                     try {
                         stream = await navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720 } });
                         videoFeed.srcObject = stream;
                         videoFeed.classList.remove('hidden');
                         cameraPlaceholder.classList.add('hidden');
                         startCameraButton.classList.add('hidden');
                         captureButton.classList.remove('hidden');
                     } catch (err) {
                         cameraPlaceholder.textContent = "Gagal mengakses kamera. Mohon izinkan akses.";
                         console.error("Error accessing camera: ", err);
                     }
                 }
             });
 
             captureButton.addEventListener('click', () => {
                 if (stream) {
                     canvas.width = videoFeed.videoWidth;
                     canvas.height = videoFeed.videoHeight;
                     const context = canvas.getContext('2d');
                     context.drawImage(videoFeed, 0, 0, canvas.width, canvas.height);
                     const dataUrl = canvas.toDataURL('image/jpeg');
                     cameraDataInput.value = dataUrl;
                     resultContainer.innerHTML = `<img src="${dataUrl}" alt="Gambar Jepretan" class="h-40 w-40 object-cover rounded-lg mx-auto shadow-md">`;
                     enableSubmit();
                     // Ubah teks tombol untuk menandakan gambar sudah diambil
                     captureButton.textContent = "Ambil Ulang";
                     captureButton.classList.replace('bg-indigo-600', 'bg-green-600');
                 }
             });
 
             // Logika Form Submission
             form.addEventListener('submit', function() {
                 buttonText.textContent = 'Memproses...';
                 loader.classList.remove('hidden');
                 submitButton.disabled = true;
             });
         });
     </script>
 
 </body>
 </html>
